<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein Calculator - Last War</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            text-align: center;
        }

        .result-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            color: #666;
            font-size: 14px;
        }

        .result-value {
            color: #333;
            font-weight: 700;
            font-size: 16px;
        }

        .time-value {
            color: #667eea;
            font-size: 24px;
            font-weight: 700;
        }

        .error {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
        }

        .icon {
            font-size: 40px;
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">üß¨</div>
        <h1>Protein Calculator</h1>
        <p class="subtitle">Last War - Saison 1</p>

        <div class="input-group">
            <label for="currentProteins">Current Proteins:</label>
            <input type="number" id="currentProteins" placeholder="e.g. 1500" min="0" step="1">
        </div>

        <div class="input-group">
            <label for="requiredProteins">Proteins Required for Upgrade:</label>
            <input type="number" id="requiredProteins" placeholder="e.g. 5000" min="0" step="1">
        </div>

        <div class="input-group">
            <label for="productionRate">Production per Hour:</label>
            <input type="number" id="productionRate" placeholder="e.g. 250" min="0" step="0.1">
        </div>

        <button onclick="calculateUpgradeTime()">üöÄ Calculate</button>

        <button id="notifyButton" onclick="setupNotification()" style="display: none; margin-top: 10px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            üîî Notify Me When Ready
        </button>

        <div id="result" class="result">
            <h2>üìä Result</h2>
            <div class="result-item">
                <span class="result-label">Missing Proteins:</span>
                <span class="result-value" id="missingProteins">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Wait Time:</span>
                <span class="result-value" id="waitTime">-</span>
            </div>
            <div class="result-item" style="flex-direction: column; gap: 10px; text-align: center;">
                <span class="result-label">Upgrade Available At:</span>
                <span class="time-value" id="upgradeTime">-</span>
            </div>
        </div>

        <div id="error" class="error"></div>
    </div>

    <script>
        let notificationTimeout = null;
        let upgradeDateTime = null;

        function calculateUpgradeTime() {
            // R√©cup√©ration des valeurs
            const currentProteins = parseFloat(document.getElementById('currentProteins').value);
            const requiredProteins = parseFloat(document.getElementById('requiredProteins').value);
            const productionRate = parseFloat(document.getElementById('productionRate').value);

            const errorDiv = document.getElementById('error');
            const resultDiv = document.getElementById('result');

            // R√©initialiser les messages d'erreur
            errorDiv.textContent = '';
            resultDiv.classList.remove('show');

            // Validation des entr√©es
            if (isNaN(currentProteins) || isNaN(requiredProteins) || isNaN(productionRate)) {
                errorDiv.textContent = '‚ö†Ô∏è Please fill in all fields';
                return;
            }

            if (currentProteins < 0 || requiredProteins < 0 || productionRate < 0) {
                errorDiv.textContent = '‚ö†Ô∏è Values must be positive';
                return;
            }

            if (productionRate === 0) {
                errorDiv.textContent = '‚ö†Ô∏è Production per hour must be greater than 0';
                return;
            }

            // V√©rifier si on a d√©j√† assez de prot√©ines
            if (currentProteins >= requiredProteins) {
                errorDiv.textContent = '‚úÖ You already have enough proteins for the upgrade!';
                errorDiv.style.color = '#27ae60';
                return;
            }

            // Calculs
            const missingProteins = requiredProteins - currentProteins;
            const hoursNeeded = missingProteins / productionRate;
            const minutesNeeded = hoursNeeded * 60;

            // Calcul de l'heure d'upgrade
            const now = new Date();
            const upgradeDate = new Date(now.getTime() + (minutesNeeded * 60 * 1000));
            upgradeDateTime = upgradeDate; // Stocker pour les notifications

            // Formatage du temps d'attente
            const days = Math.floor(hoursNeeded / 24);
            const hours = Math.floor(hoursNeeded % 24);
            const minutes = Math.floor((hoursNeeded * 60) % 60);

            let waitTimeText = '';
            if (days > 0) {
                waitTimeText += `${days} day${days > 1 ? 's' : ''} `;
            }
            if (hours > 0 || days > 0) {
                waitTimeText += `${hours} hour${hours > 1 ? 's' : ''} `;
            }
            waitTimeText += `${minutes} minute${minutes > 1 ? 's' : ''}`;

            // Formatage de l'heure d'upgrade
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const upgradeTimeText = upgradeDate.toLocaleDateString('en-US', options);

            // Affichage des r√©sultats
            document.getElementById('missingProteins').textContent = Math.ceil(missingProteins).toLocaleString('en-US');
            document.getElementById('waitTime').textContent = waitTimeText;
            document.getElementById('upgradeTime').textContent = upgradeTimeText;

            resultDiv.classList.add('show');
            
            // Afficher le bouton de notification
            document.getElementById('notifyButton').style.display = 'block';
        }

        // Permettre le calcul avec la touche Entr√©e
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    calculateUpgradeTime();
                }
            });
        });

        // Fonction pour demander la permission et configurer la notification
        async function setupNotification() {
            const notifyButton = document.getElementById('notifyButton');
            
            // V√©rifier si les notifications sont support√©es
            if (!('Notification' in window)) {
                alert('‚ùå Your browser does not support notifications. Please try with Chrome, Firefox, Safari, or Edge.');
                return;
            }

            // Demander la permission
            if (Notification.permission === 'default') {
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') {
                    alert('‚ùå Notification permission denied. Please enable notifications in your browser settings.');
                    return;
                }
            } else if (Notification.permission === 'denied') {
                alert('‚ùå Notifications are blocked. Please enable them in your browser settings.');
                return;
            }

            // Calculer le d√©lai jusqu'√† la notification
            const now = new Date();
            const timeUntilUpgrade = upgradeDateTime - now;

            if (timeUntilUpgrade <= 0) {
                alert('‚úÖ Your upgrade is already ready!');
                return;
            }

            // Annuler toute notification pr√©c√©dente
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
            }

            // Programmer la notification
            notificationTimeout = setTimeout(() => {
                showNotification();
            }, timeUntilUpgrade);

            // Mettre √† jour le bouton
            notifyButton.textContent = '‚úÖ Notification Set!';
            notifyButton.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
            notifyButton.disabled = true;

            // Afficher un message de confirmation
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = '‚úÖ You will be notified when your upgrade is ready!';
            errorDiv.style.color = '#27ae60';

            // Garder la page active (optionnel - pour information)
            if (timeUntilUpgrade > 300000) { // Plus de 5 minutes
                setTimeout(() => {
                    if (errorDiv.textContent.includes('notified')) {
                        errorDiv.textContent += ' ‚ö†Ô∏è Keep this tab open for the notification to work.';
                    }
                }, 2000);
            }
        }

        // Fonction pour afficher la notification
        function showNotification() {
            const notification = new Notification('üß¨ Last War - Upgrade Ready!', {
                body: 'Your protein production is complete! You can now upgrade your building.',
                icon: 'üß¨',
                badge: 'üß¨',
                tag: 'lastwar-upgrade',
                requireInteraction: true, // La notification reste affich√©e
                vibrate: [200, 100, 200] // Vibration sur mobile
            });

            // Jouer un son (optionnel)
            try {
                const audio = new Audio('data:audio/wav;base64,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');
                audio.play().catch(() => {}); // Ignorer les erreurs de son
            } catch (e) {
                // Ignorer les erreurs de son
            }

            // Ouvrir la page si on clique sur la notification
            notification.onclick = function() {
                window.focus();
                notification.close();
            };
        }

        // V√©rifier si on revient sur la page (pour restaurer l'√©tat)
        window.addEventListener('load', () => {
            if (Notification.permission === 'granted' && notificationTimeout) {
                document.getElementById('notifyButton').textContent = '‚úÖ Notification Set!';
                document.getElementById('notifyButton').style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
            }
        });
    </script>
</body>
</html>
